<title>The Seven Ducks</title>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Three.js Shooter</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { margin:0; overflow:hidden; background:black; touch-action:none; }
#crosshair {
  position: fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  font-size:22px;
  color:white;
}
#joystick {
  position: fixed;
  left:20px;
  bottom:20px;
  width:120px;
  height:120px;
  border-radius:50%;
  background:rgba(255,255,255,0.1);
}
#stick {
  position:absolute;
  left:40px;
  top:40px;
  width:40px;
  height:40px;
  border-radius:50%;
  background:rgba(255,255,255,0.5);
}
</style>
</head>
<body>

<div id="crosshair">+</div>
<div id="joystick"><div id="stick"></div></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/controls/PointerLockControls.js"></script>

<script>
// ================== SETUP ==================
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x000000);

const camera = new THREE.PerspectiveCamera(50, innerWidth/innerHeight, 0.01, 1000);
camera.position.set(0,1.6,5);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
document.body.appendChild(renderer.domElement);

// ================== LIGHT ==================
scene.add(new THREE.AmbientLight(0x666666));
const sun = new THREE.DirectionalLight(0xffffff,1);
sun.position.set(5,10,5);
scene.add(sun);

// ================== FLOOR ==================
const floor = new THREE.Mesh(
  new THREE.BoxGeometry(20,0.2,20),
  new THREE.MeshStandardMaterial({color:0x444444})
);
floor.position.y = -0.1;
scene.add(floor);

// ================== CONTROLS ==================
const controls = new THREE.PointerLockControls(camera, document.body);
document.body.addEventListener("click", ()=>controls.lock());
scene.add(controls.getObject());

// ================== GUN ==================
const gun = new THREE.Mesh(
  new THREE.BoxGeometry(0.3,0.2,0.8),
  new THREE.MeshStandardMaterial({color:0x222222})
);
gun.position.set(0.3,-0.3,-0.8);
camera.add(gun);

// ================== MOVEMENT (WASD) ==================
const keys = {};
document.addEventListener("keydown", e=>keys[e.key.toLowerCase()]=true);
document.addEventListener("keyup", e=>keys[e.key.toLowerCase()]=false);

let velocity = new THREE.Vector3();

// ================== MOBILE JOYSTICK ==================
const joystick = document.getElementById("joystick");
const stick = document.getElementById("stick");
let joyX=0, joyY=0, touching=false;

joystick.addEventListener("touchstart", e=>{
  touching=true;
});
joystick.addEventListener("touchmove", e=>{
  const rect = joystick.getBoundingClientRect();
  const t = e.touches[0];
  joyX = (t.clientX - rect.left - 60) / 60;
  joyY = (t.clientY - rect.top - 60) / 60;
  joyX = Math.max(-1,Math.min(1,joyX));
  joyY = Math.max(-1,Math.min(1,joyY));
  stick.style.left = 40 + joyX*30 + "px";
  stick.style.top  = 40 + joyY*30 + "px";
});
joystick.addEventListener("touchend", ()=>{
  touching=false;
  joyX=joyY=0;
  stick.style.left="40px";
  stick.style.top="40px";
});

// ================== ENEMIES ==================
const enemies=[];
function spawnEnemy(){
  const e = new THREE.Mesh(
    new THREE.BoxGeometry(0.6,1,0.6),
    new THREE.MeshStandardMaterial({color:0xff0000})
  );
  e.position.set((Math.random()-0.5)*10,0.5,-10-Math.random()*10);
  e.health=3;
  scene.add(e);
  enemies.push(e);
}
for(let i=0;i<5;i++) spawnEnemy();

// ================== SHOOT ==================
const raycaster = new THREE.Raycaster();
function shoot(){
  raycaster.setFromCamera(new THREE.Vector2(0,0),camera);
  const hit = raycaster.intersectObjects(enemies)[0];
  if(hit){
    hit.object.health--;
    hit.object.material.color.set(0xffff00);
    setTimeout(()=>hit.object.material.color.set(0xff0000),100);
    if(hit.object.health<=0){
      scene.remove(hit.object);
      enemies.splice(enemies.indexOf(hit.object),1);
      spawnEnemy();
    }
  }
}
addEventListener("mousedown",shoot);
addEventListener("touchstart",shoot);

// ================== LOOP ==================
function animate(){
  requestAnimationFrame(animate);

  velocity.set(0,0,0);
  if(keys["w"]) velocity.z-=0.08;
  if(keys["s"]) velocity.z+=0.08;
  if(keys["a"]) velocity.x-=0.08;
  if(keys["d"]) velocity.x+=0.08;

  // Mobile move
  velocity.x += joyX*0.08;
  velocity.z += joyY*0.08;

  controls.moveRight(velocity.x);
  controls.moveForward(velocity.z);

  enemies.forEach(e=>{
    e.position.z += 0.02;
    if(e.position.z>camera.position.z) e.position.z=-20;
  });

  renderer.render(scene,camera);
}
animate();

// ================== RESIZE ==================
addEventListener("resize",()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>

