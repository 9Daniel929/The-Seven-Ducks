<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Fixed Shooter Game</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  margin: 0;
  overflow: hidden;
  background: black;
  touch-action: none;
}
#crosshair {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: white;
  font-size: 22px;
  pointer-events: none;
}
#joystick {
  position: fixed;
  left: 20px;
  bottom: 20px;
  width: 120px;
  height: 120px;
  border-radius: 50%;
  background: rgba(255,255,255,0.15);
}
#stick {
  position: absolute;
  left: 40px;
  top: 40px;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: rgba(255,255,255,0.6);
}
</style>
</head>
<body>

<div id="crosshair">+</div>
<div id="joystick"><div id="stick"></div></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>

<script>
// ================== BASIC SETUP ==================
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x111111);

const camera = new THREE.PerspectiveCamera(
  70,
  window.innerWidth / window.innerHeight,
  0.1,
  1000
);
camera.position.set(0, 1.6, 6);
scene.add(camera);

const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// ================== LIGHT ==================
scene.add(new THREE.AmbientLight(0xffffff, 0.6));

const light = new THREE.DirectionalLight(0xffffff, 1);
light.position.set(5, 10, 5);
scene.add(light);

// ================== FLOOR ==================
const floor = new THREE.Mesh(
  new THREE.BoxGeometry(30, 0.2, 30),
  new THREE.MeshStandardMaterial({ color: 0x444444 })
);
floor.position.y = -0.1;
scene.add(floor);

// ================== GUN ==================
const gun = new THREE.Mesh(
  new THREE.BoxGeometry(0.3, 0.2, 0.8),
  new THREE.MeshStandardMaterial({ color: 0x222222 })
);
gun.position.set(0.3, -0.3, -1);
camera.add(gun);

// ================== ENEMIES ==================
const enemies = [];

function spawnEnemy() {
  const enemy = new THREE.Mesh(
    new THREE.BoxGeometry(0.8, 1.2, 0.8),
    new THREE.MeshStandardMaterial({ color: 0xff3333 })
  );
  enemy.position.set(
    (Math.random() - 0.5) * 20,
    0.6,
    -Math.random() * 20 - 5
  );
  enemy.health = 3;
  scene.add(enemy);
  enemies.push(enemy);
}

for (let i = 0; i < 6; i++) spawnEnemy();

// ================== SHOOTING ==================
const raycaster = new THREE.Raycaster();

function shoot() {
  raycaster.setFromCamera(new THREE.Vector2(0, 0), camera);
  const hits = raycaster.intersectObjects(enemies);

  if (hits.length > 0) {
    const enemy = hits[0].object;
    enemy.health--;
    enemy.material.color.set(0xffff00);

    setTimeout(() => {
      if (enemy.material) enemy.material.color.set(0xff3333);
    }, 100);

    if (enemy.health <= 0) {
      scene.remove(enemy);
      enemies.splice(enemies.indexOf(enemy), 1);
      spawnEnemy();
    }
  }
}

window.addEventListener("mousedown", shoot);
window.addEventListener("touchstart", shoot);

// ================== MOVEMENT ==================
const keys = {};
window.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
window.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

// ================== MOBILE JOYSTICK ==================
const joystick = document.getElementById("joystick");
const stick = document.getElementById("stick");
let joyX = 0, joyY = 0;

joystick.addEventListener("touchmove", e => {
  const rect = joystick.getBoundingClientRect();
  const t = e.touches[0];
  joyX = (t.clientX - rect.left - 60) / 60;
  joyY = (t.clientY - rect.top - 60) / 60;
  joyX = Math.max(-1, Math.min(1, joyX));
  joyY = Math.max(-1, Math.min(1, joyY));
  stick.style.left = 40 + joyX * 30 + "px";
  stick.style.top  = 40 + joyY * 30 + "px";
});

joystick.addEventListener("touchend", () => {
  joyX = joyY = 0;
  stick.style.left = "40px";
  stick.style.top = "40px";
});

// ================== GAME LOOP ==================
function animate() {
  requestAnimationFrame(animate);

  const speed = 0.1;

  if (keys["w"]) camera.translateZ(-speed);
  if (keys["s"]) camera.translateZ(speed);
  if (keys["a"]) camera.translateX(-speed);
  if (keys["d"]) camera.translateX(speed);

  camera.translateX(joyX * speed);
  camera.translateZ(joyY * speed);

  enemies.forEach(e => {
    e.position.z += 0.03;
    if (e.position.z > camera.position.z + 2) {
      e.position.z = -25;
    }
  });

  renderer.render(scene, camera);
}
animate();

// ================== RESIZE ==================
window.addEventListener("resize", () => {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>

</body>
</html>
